const array10per = [
    0.1, 0.18543, 0.19567, 0.20, 0.22, 0.23, 0.24, 0.25,
    0.26, 0.45, 0.46, 0.47, 0.48, 0.49, 0.50, 0.51,
    0.54, 0.56462, 0.58462, 0.60970, 0.62432, 0.64194, 0.65976, 0.67666,
    0.69421, 0.70874, 0.72328, 0.73727, 0.75052, 0.76409, 0.77666, 0.79059,
    0.80227, 0.81000, 0.82168, 0.83442, 0.84777, 0.85613, 0.86931, 0.87265
];
const array9per = [
    0.08661, 0.09543, 0.10567, 0.19, 0.16285, 0.19289, 0.36837, 0.39247,
    0.40622, 0.44141, 0.45170, 0.46404, 0.46564, 0.48234, 0.49304, 0.51485,
    0.53486, 0.55962, 0.57962, 0.60470, 0.61932, 0.63694, 0.65476, 0.67166,
    0.68921, 0.70374, 0.71828, 0.73027, 0.74552, 0.75909, 0.77166, 0.78559,
    0.79727, 0.80500, 0.81668, 0.82942, 0.83277, 0.85113, 0.85331, 0.86765
];
const array8per = [
    0.07661, 0.08543, 0.09567, 0.14, 0.15785, 0.18789, 0.36337, 0.38747,
    0.40122, 0.43641, 0.44670, 0.45904, 0.46064, 0.47734, 0.48804, 0.50985,
    0.52986, 0.55462, 0.57462, 0.59970, 0.61432, 0.63194, 0.64976, 0.66666,
    0.68421, 0.69874, 0.71328, 0.72727, 0.74052, 0.75409, 0.76666, 0.78059,
    0.79227, 0.80000, 0.81168, 0.82442, 0.82777, 0.84613, 0.84931, 0.86265
];
const array7per = [
    0.07661, 0.08543, 0.09567, 0.14, 0.15785, 0.18789, 0.26337, 0.28747,
    0.30122, 0.32641, 0.34670, 0.36904, 0.38064, 0.41734, 0.44214, 0.46985,
    0.48986, 0.50433, 0.52222, 0.54370, 0.56281, 0.58055, 0.59786, 0.61394,
    0.63157, 0.64644, 0.66200, 0.67532, 0.69096, 0.70918, 0.71481, 0.72995,
    0.73913, 0.75000, 0.76623, 0.77099, 0.78181, 0.79032, 0.80123, 0.81965
];
const array6per = [
    0.05661, 0.07543, 0.11567, 0.13, 0.15785, 0.17789, 0.21337, 0.23747,
    0.26122, 0.28411, 0.30670, 0.32904, 0.35064, 0.37173, 0.39224, 0.41216,
    0.43129, 0.45077, 0.46935, 0.48759, 0.50424, 0.52227, 0.53828, 0.55485,
    0.57023, 0.58615, 0.60068, 0.61436, 0.62947, 0.64235, 0.65526, 0.66863,
    0.67892, 0.69201, 0.70434, 0.715, 0.72429, 0.73544, 0.74545, 0.75409
];
const array5per = [
    0.03661, 0.05543, 0.09567, 0.10, 0.13785, 0.15789, 0.20337, 0.22747,
    0.25122, 0.26411, 0.28670, 0.30904, 0.32064, 0.34173, 0.36, 0.38,
    0.39, 0.40, 0.41, 0.42759, 0.44424, 0.46227, 0.47828, 0.48639,
    0.50123, 0.51464, 0.52913, 0.54285, 0.55685, 0.57049, 0.58148, 0.5949,
    0.6086, 0.622, 0.62987, 0.64122, 0.65454, 0.67032, 0.67123, 0.68965
];
const array4per = [
    0.03661, 0.05543, 0.09567, 0.10, 0.13785, 0.15789, 0.20343, 0.23254,
    0.24235, 0.25233, 0.27534, 0.29456, 0.30444, 0.31345, 0.32345, 0.33435,
    0.34545, 0.35543, 0.36353, 0.37874, 0.38988, 0.39049, 0.40422, 0.41333,
    0.42323, 0.43533, 0.44755, 0.45974, 0.47230, 0.48524, 0.49629, 0.51054,
    0.52173, 0.53333, 0.54545, 0.55725, 0.56363, 0.58241, 0.58904, 0.60344
];
const array3per = [
    0.03661, 0.05543, 0.09567, 0.10, 0.13785, 0.15, 0.14999, 0.15999,
    0.16999, 0.17999, 0.20999, 0.21999, 0.22999, 0.23999, 0.24999, 0.25999,
    0.26999, 0.27999, 0.28999, 0.29759, 0.30999, 0.31999, 0.32999, 0.33999,
    0.34909, 0.35999, 0.36549, 0.37899, 0.38999, 0.39845, 0.40148, 0.40949,
    0.42086, 0.42777, 0.43506, 0.45038, 0.45454, 0.47032, 0.47923, 0.48965
];
const startYear = 1998;
const startAmount = 600;
const startAnaprosarmogi = 0;
const anaprosarmogiSelected = document.getElementById("anaprosarmogi");

$("#xrimatistirio").addClass('display_none');
const getMarketsInfo = () => {
    const show_markets = document.getElementById("neededinitialmonthlyinvestment")
        .classList.contains("super");
    if (show_markets) {
        $("#xrimatistirio").removeClass('display_none');
        // change markets
        const cards_of_markets = document.querySelectorAll(".card-title");
        cards_of_markets
            .forEach((card) => {cal(card)});
        return
    }
    $("#xrimatistirio").addClass('display_none');
}


$(document).ready(function () {
    $("#mone,#age,#averageIncome,#workyearsuntilnow,#workyearsuntilpension,#syntelanapl,#initpension,#nationalpension,#totalpension,#wantedpension,#neededprivatepension,#neededcapitaluntil85,#neededinitialmonthlyinvestment,#initialmonthlyinvestment,#initialcapital,#anualperformance,#anualadjustment,#endingvalue,#endingvaluepermonth")
        .keyup(function () {
            $("#syntelanapl").val(rate_of_return(
                Number($("#workyearsuntilnow").val()),
                Number($("#workyearsuntilpension").val()))
            );
            $("#initpension").val(Math.round(compensatory_pension(
                Number($("#averageIncome").val()),
                Number($("#syntelanapl").val()))
            ));
            $("#nationalpension").val(Math.round(national_pension(
                Number($("#workyearsuntilnow").val()),
                Number($("#workyearsuntilpension").val()))
            ));
            $("#totalpension").val(Math.round(pension_reduction(total_pension(
                Number($("#nationalpension").val()),
                Number($("#initpension").val()))
            )));

            $("#neededprivatepension").val(Math.round(private_pension_needed(
                Number($("#wantedpension").val()),
                Number($("#totalpension").val()))
            ));
            $("#neededcapitaluntil85").val(Math.round(needed_capital(
                Number($("#age").val()),
                Number($("#workyearsuntilpension").val()),
                Number($("#neededprivatepension").val()))
                // Number($("#wantedpension").val()),
                // Number($("#totalpension").val()))
            ));
            /////////////////////////////////
            $("#endingvalue").val(Math.round(ending_total_value_after_revenue_input(
                Number($("#initialmonthlyinvestment").val()),
                Number($("#initialcapital").val()),
                Number($("#anualperformance").val()),
                Number($("#anualadjustment").val()),
                Number($("#workyearsuntilpension").val()))
            ));
            $("#endingvaluepermonth").val(Math.round(ending_per_month_pension(
                Number($("#endingvalue").val()),
                Number($("#age").val()),
                Number($("#workyearsuntilpension").val()))
            ));
            const annual_perfomance = Number($("#anualperformance").val());
            const annual_adjustment = Number($("#anualadjustment").val());
            document.getElementById("neededinitialmonthlyinvestment")
                .classList.remove("super");
            getMarketsInfo();
            if (annual_perfomance >= 3 && annual_perfomance <= 10) {
                document.getElementById("neededinitialmonthlyinvestment")
                    .classList.add('super');
                //TODO
                let temp = Math.round(needed_capital_per_month(
                    Number($("#neededcapitaluntil85").val()),
                    Number($("#workyearsuntilpension").val())));
                if (!$("#initialcapital").val() || $("#initialcapital").val() === '0') {
                    //Changes
                    let money = percentage_decrease_of_initial_investment_price(
                        Number($("#anualperformance").val()),
                        Number($("#workyearsuntilpension").val()),
                        // Number($("#initialmonthlyinvestment").val())
                        temp
                    );
                    $("#neededinitialmonthlyinvestment").val(money);
                } else {
                    let money = percentage_decrease_of_initial_investment_price(
                        Number($("#anualperformance").val()),
                        Number($("#workyearsuntilpension").val()),
                        temp
                    );
                    let count = Number($("#initialcapital").val());
                    for (let temp = 0; temp < Number($("#workyearsuntilpension").val()); temp++) {
                        count = count * (1 + Number($("#anualperformance").val() / 100));
                    }
                    console.log(count);
                    let merge = (count / 12)
                        / Number($("#workyearsuntilpension").val());
                    $("#neededinitialmonthlyinvestment").val(money - merge);
                }
                getMarketsInfo()
            } else if ($("#anualperformance").val() === "" || annual_perfomance === 0) {
                efapaxToNeedInitialToMonth();
            } else if (annual_perfomance === 1) {
                efapaxToNeedInitialToMonth();
            } else if (annual_perfomance < 3 || annual_perfomance > 10) {
                efapaxToNeedInitialToMonth();
                $("#anualperformance").val(0);
                $("#neededinitialmonthlyinvestment").val(needed_capital_per_month(
                    Number($("#neededcapitaluntil85").val()),
                    Number($("#workyearsuntilpension").val()))
                );
                alert("Από 3 εώς 10%")
            } else {
                efapaxToNeedInitialToMonth();
                $("#anualperformance").val(0); // replace value
                alert("Δώσε αριθμητική τιμή");
            }

            if (annual_adjustment == 3 || annual_adjustment == 6 ) {
                //TODO
                if (annual_perfomance >= 3 && annual_perfomance <= 10) {
                    document.getElementById("neededinitialmonthlyinvestment")
                        .classList.add('super');
                    //TODO
                    let temp = Math.round(needed_capital_per_month(
                        Number($("#neededcapitaluntil85").val()),
                        Number($("#workyearsuntilpension").val())));
                    if (!$("#initialcapital").val() || $("#initialcapital").val() === '0') {
                        //Changes
                        let money = percentage_decrease_of_initial_investment_price(
                            Number($("#anualperformance").val())+annual_adjustment,
                            Number($("#workyearsuntilpension").val()),
                            // Number($("#initialmonthlyinvestment").val())
                            temp
                        );
                        $("#neededinitialmonthlyinvestment").val(money);
                    } else {
                        let money = percentage_decrease_of_initial_investment_price(
                            Number($("#anualperformance").val())+annual_adjustment,
                            Number($("#workyearsuntilpension").val()),
                            temp
                        );
                        let count = Number($("#initialcapital").val());
                        for (let temp = 0; temp < Number($("#workyearsuntilpension").val()); temp++) {
                            count = count * (1 + Number($("#anualperformance").val() / 100)+annual_adjustment);
                        }
                        console.log(count);
                        let merge = (count / 12)
                            / Number($("#workyearsuntilpension").val());
                        $("#neededinitialmonthlyinvestment").val(money - merge);
                    }
                    getMarketsInfo();
                } else if ($("#anualperformance").val() === "" || annual_perfomance === 0) {
                    efapaxToNeedInitialToMonth();
                } else if (annual_perfomance === 1) {
                    efapaxToNeedInitialToMonth();
                } else if (annual_perfomance < 3 || annual_perfomance > 10) {
                    efapaxToNeedInitialToMonth();
                    $("#anualperformance").val(0);
                    $("#neededinitialmonthlyinvestment").val(needed_capital_per_month(
                        Number($("#neededcapitaluntil85").val()),
                        Number($("#workyearsuntilpension").val()))
                    );
                    alert("Από 3 εώς 10%")
                } else {
                    efapaxToNeedInitialToMonth();
                    $("#anualperformance").val(0); // replace value
                    alert("Δώσε αριθμητική τιμή");
                }
            } else if (!annual_adjustment == 3 || !annual_perfomance == 6 || !annual_adjustment == 0) {
                efapaxToNeedInitialToMonth();
                $("#anualadjustment").val(0);
                $("#neededinitialmonthlyinvestment").val(needed_capital_per_month(
                    Number($("#neededcapitaluntil85").val()),
                    Number($("#workyearsuntilpension").val()))
                );
                alert("Από 0, 3 ή 6")
            }


    });
});
//μειωση συνταξης βάσει τύπου eurolife
function pension_reduction(pension){
    let n409312;
    if (pension >= 1052 && pension < 1500){
        n409312 = 5/100;
        pension = pension - pension * n409312;
    }else if(pension >= 1600 && pension < 2000){
        n409312 = 10/100;
        pension = pension - pension * n409312;
    }else if(pension >= 2100 && pension < 3000){
        n409312 = 15/100;
        pension = pension - pension * n409312;
    }else if(pension >= 3200){
        n409312 = 20/100;
        pension = pension - pension * n409312;
    }
    let incometax = 4.37/100;
    pension = pension - pension * incometax;

    let taxforcharity = 6/100;
    pension = pension - pension * taxforcharity;
    return pension;
}


//συντελεστης αναπληρωσης
function rate_of_return(years_worked, years_until_pention) {
    if (years_worked + years_until_pention <= 15) {
        return 11.55;
    } else if (years_worked + years_until_pention == 16) {
        return 12.39;
    } else if (years_worked + years_until_pention == 17) {
        return 13.23;
    } else if (years_worked + years_until_pention == 18) {
        return 14.07;
    } else if (years_worked + years_until_pention == 19) {
        return 14.97;
    } else if (years_worked + years_until_pention == 20) {
        return 15.87;
    } else if (years_worked + years_until_pention == 21) {
        return 16.77;
    } else if (years_worked + years_until_pention == 22) {
        return 17.73;
    } else if (years_worked + years_until_pention == 23) {
        return 18.69;
    } else if (years_worked + years_until_pention == 24) {
        return 19.65;
    } else if (years_worked + years_until_pention == 25) {
        return 20.68;
    } else if (years_worked + years_until_pention == 26) {
        return 21.71;
    } else if (years_worked + years_until_pention == 27) {
        return 22.74;
    } else if (years_worked + years_until_pention == 28) {
        return 23.95;
    } else if (years_worked + years_until_pention == 29) {
        return 25.16;
    } else if (years_worked + years_until_pention == 30) {
        return 27.14;
    } else if (years_worked + years_until_pention == 31) {
        return 29.12;
    } else if (years_worked + years_until_pention == 32) {
        return 31.10;
    } else if (years_worked + years_until_pention == 33) {
        return 33.08;
    } else if (years_worked + years_until_pention == 34) {
        return 35.58;
    } else if (years_worked + years_until_pention == 35) {
        return 38.08;
    } else if (years_worked + years_until_pention == 36) {
        return 40.58;
    } else if (years_worked + years_until_pention == 37) {
        return 43.13;
    } else if (years_worked + years_until_pention == 38) {
        return 45.68;
    } else if (years_worked + years_until_pention == 39) {
        return 48.23;
    } else if (years_worked + years_until_pention == 40) {
        return 50.78;
    } else if (years_worked + years_until_pention == 41) {
        return 51.28;
    } else if (years_worked + years_until_pention == 42) {
        return 51.78;
    } else if (years_worked + years_until_pention == 43) {
        return 52.28;
    } else if (years_worked + years_until_pention == 44) {
        return 52.78;
    } else if (years_worked + years_until_pention == 45) {
        return 53.28;
    } else {
        return 53.28;
    }
}

//ανταποδοτικη συνταξη
function compensatory_pension(average_salary, rate_of_return) {
    rate_of_return /= 100;
    return average_salary * rate_of_return;
}

//εθνική σύνταξη
function national_pension(years_worked, years_until_pension) {
    if (years_worked + years_until_pension >= 20) {
        return 384;
    } else if (years_worked + years_until_pension <= 15) {
        return 345.6;
    } else if (years_worked + years_until_pension == 16) {
        return 353.28;
    } else if (years_worked + years_until_pension == 17) {
        return 360.96;
    } else if (years_worked + years_until_pension == 18) {
        return 369;
    } else if (years_worked + years_until_pension == 19) {
        return 376.32;
    } else {
        return 345.6;
    }
}

//σύνταξη
function total_pension(national_pension, compensatory_pension) {
    return national_pension + compensatory_pension;
}

//ιδιωτική αναγκαία σύνταξη
function private_pension_needed(wanted_pension, total_pension) {
    if((wanted_pension - total_pension) < 0){
        return 0;
    }else {
        return wanted_pension - total_pension;
    }
}

//απαιτούμενο κεφάλαιο
// function needed_capital(age, years_untill_pension, wanted_pension, total_pension) {
//     return (85 - age - years_untill_pension) * 12 * (wanted_pension - total_pension);
// }
function needed_capital(age, years_untill_pension, neededprivaate) {
    console.log(age, years_untill_pension, neededprivaate);
    return (85 - age - years_untill_pension) * 12 * neededprivaate;
}

//απαιτούμενο κεφάλαιο ανά μήνα
function needed_capital_per_month(needed_capital, years_until_pension) {
    return (needed_capital / years_until_pension) / 12;
}

//ενδεικτική τελική αξία στην λήξη
function ending_total_value(starting_monthly_capital, starting_capital, year_revenue, year_change, years_until_pension) {
    total_value = 0.0;
    total_value = total_value + starting_capital;
    for (i = 0; i < years_until_pension; i++) {
        // total_value += (starting_capital * (year_revenue/100));
        starting_monthly_capital = starting_monthly_capital + (starting_monthly_capital * (year_change / 100));
        total_value = total_value + (starting_monthly_capital * 12);
        total_value = total_value + (total_value * (year_revenue / 100));
    }
    return total_value;
}

//ενδεικτική μηνιαία σύνταξη στην λήξη
function ending_per_month_pension(ending_total_value, age, years_until_pension) {
    return (ending_total_value / 12) / (85 - (age + years_until_pension));
}

//τροποποίηση μηνιαίου ποσού μετά το revenue
function ending_total_value_after_revenue_input(starting_monthly_capital, starting_capital, year_revenue, year_change, years_until_pension) {
    total_value = 0.0;
    total_value = total_value + starting_capital;
    for (i = 0; i < years_until_pension; i++) {
        // total_value += (starting_capital * (year_revenue/100));

        starting_monthly_capital = starting_monthly_capital + (starting_monthly_capital * (year_change / 100));
        total_value = total_value + (starting_monthly_capital * 12);
        total_value = total_value + (total_value * (year_revenue / 100));
    }
    return total_value;
}


const percentage_decrease_of_initial_investment_price = (percentage,
                                                         remain_years,
                                                         initial_amount_per_month) => {
    if (remain_years > 40 || remain_years < 1) {
        return false;
    } else if (percentage === 3) {
        return initial_amount_per_month * (1 - array3per[remain_years - 1]);
    } else if (percentage === 4) {
        return initial_amount_per_month * (1 - array4per[remain_years - 1]);
    } else if (percentage === 5) {
        return initial_amount_per_month * (1 - array5per[remain_years - 1]);
    } else if (percentage === 6) {
        return initial_amount_per_month * (1 - array6per[remain_years - 1]);
    } else if (percentage === 7) {
        return initial_amount_per_month * (1 - array7per[remain_years - 1]);
    } else if (percentage === 8) {
        return initial_amount_per_month * (1 - array8per[remain_years - 1]);
    } else if (percentage === 9) {
        return initial_amount_per_month * (1 - array9per[remain_years - 1]);
    } else if (percentage === 10) {
        return initial_amount_per_month * (1 - array10per[remain_years - 1]);
    }
};

const efapaxToNeedInitialToMonth = () => {
    if (!$("#initialcapital").val() || $("#initialcapital").val() === '0') {
        $("#neededinitialmonthlyinvestment").val(Math.round(needed_capital_per_month(
            Number($("#neededcapitaluntil85").val()),
            Number($("#workyearsuntilpension").val()))
        ));
    } else {
        $("#neededinitialmonthlyinvestment").val(Math.round(needed_capital_per_month(
            Number($("#neededcapitaluntil85").val()) - Number($("#initialcapital").val()),
            Number($("#workyearsuntilpension").val()))
        ));
    }
};